## Codebase Patterns

- Use `getSandbox` from `@cloudflare/sandbox` to create sandbox instances
- Export `Sandbox` from index.ts for Cloudflare container runtime
- Prompts are stored in `/prompts/` directory and copied into container
- SPEC.md contains the complete API specification and framework templates
- Auth middleware: `requireAuth(request, env)` returns `{ success: true }` or `{ success: false, response: Response }`
- Job state: Use `createJob(request)`, `getJob(id)`, `updateJob(id, updates)` from src/jobs.ts
- Types: Job, JobStatus, ExploreRequest, ExploreMode, ModelType are all exported from src/jobs.ts
- Type Sandbox namespace as `DurableObjectNamespace<Sandbox>` (import Sandbox from @cloudflare/sandbox)
- Git auth in containers: Use `https://x-access-token:$GITHUB_PAT@github.com/<repo>.git` for PAT-based cloning
- Use `generateSlug` from src/utils/slug.ts for URL-safe slugs (max 50 chars, kebab-case)
- Container env vars: Pass to sandbox via `sandbox.setEnvVars({ KEY: value })` before running commands
- Webhook: Use `sendWebhook(job, githubRepo, branch)` from src/utils/webhook.ts for webhook delivery with HMAC-SHA256 signatures
- Logging: Use `logInfo(jobId, event, data?)` and `logError(jobId, operation, error)` for structured JSON logging with job_id context
- Retry pattern: Use `cloneWithRetry` and `pushWithRetry` in src/index.ts for git operations with retry logic
- Current git clone: Uses `--depth 1 --branch <branch>` (shallow clone) - will change to sparse checkout

---

# Progress Log

## Feature: Same-Repo Storage with Sparse Checkout

Migrating idea storage from separate repo to subdirectory in nbbaier/idea-explorer with Git sparse checkout.

---
